/*! graph_web 28-08-2015 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;b={_create:function(){return this._state={}},_init:function(){return this._super(),null==this.options.config&&(this.options.config={}),null==this.options.config.moreYaxis&&(this.options.config.moreYaxis=!1),null==this.options.config.y_format&&(this.options.config.y_format=""),null==this.options.config.max_x_labels&&(this.options.config.max_x_labels=this.options.split===!0?5:10),null==this.options.config.disp_points&&(this.options.config.disp_points=!1),this.append_configrations()},append_configrations:function(){var a,b;return a='<li data-placement="bottom" data-toggle="config-chart-popover" data-title="Configure chart"\n    data-container="body" type="button" data-html="true">\n  <a href="#"> <i class="fa fa-bars"></i> </a></li> ',b=this.options.toolbar,b.find(".chartify_hook").replaceWith(a),b.find("[data-toggle=config-chart-popover]").popover({html:!0,placement:"right",container:this.element,content:function(a){return function(){return $(c.chart_config(a.options)).html()}}(this)}),b.find("[data-toggle=config-chart-popover]").on("shown.bs.popover",function(a){return function(){var c;return c=a.element.find(".popover").find("#chart-config"),a.options.config.moreYaxis===!1?c.find("#metric_select").prop("disabled",!0):(c.find("#add_axis").prop("checked",!0),c.find("#metric_select").find("#"+a.options.config.moreYaxis).attr("selected",!0)),a.options.config.xgrid===!0&&c.find("#add_grid_x").prop("checked",!0),a.options.config.ygrid===!0&&c.find("#add_grid_y").prop("checked",!0),a.options.config.rotateAxis===!0&&c.find("#rotate_axis").prop("checked",!0),a.options.config.subchart===!0&&c.find("#subchart").prop("checked",!0),a.options.config.subchart===!0&&c.find("#subchart").prop("checked",!0),a.options.config.disp_points===!0&&c.find("#disp_points").prop("checked",!0),c.find("#max_x_labels").val(a.options.config.max_x_labels),c.find("#add_axis").on("click",function(a){return c.find("#add_axis").is(":checked")?c.find("#metric_select").prop("disabled",!1):c.find("#metric_select").prop("disabled",!0)}),c.find("#format_y_axis").on("change",function(a){return"custom"===c.find("#format_y_axis").children(":selected").attr("value")?c.find("#custom_y_format").css("display","inline-block"):c.find("#custom_y_format").hide()}),c.on("submit",function(d){var e,f,g;return d.preventDefault(),g=c.find("#format_y_axis").children(":selected").attr("value"),"custom"===g?(e=c.find("#custom_y_format").val(),a.options.config.y_format=e):a.options.config.y_format=g,b.find("[data-toggle=config-chart-popover]").popover("hide"),c.find("#add_grid_x").is(":checked")?a.options.config.xgrid=!0:a.options.config.xgrid=!1,c.find("#add_grid_y").is(":checked")?a.options.config.ygrid=!0:a.options.config.ygrid=!1,c.find("#rotate_axis").is(":checked")?a.options.config.rotateAxis=!0:a.options.config.rotateAxis=!1,c.find("#subchart").is(":checked")?a.options.config.subchart=!0:a.options.config.subchart=!1,c.find("#disp_points").is(":checked")?a.options.config.disp_points=!0:a.options.config.disp_points=!1,g=parseInt(c.find("#max_x_labels").val()),Number.isInteger(g)===!0&&(a.options.config.max_x_labels=g),c.find("#add_axis").is(":checked")?(f=c.find("#metric_select").children(":selected").attr("id"),void 0===f?a.options.config.moreYaxis=!1:(a.options.config.moreYaxis=f,a.render_chart())):(a.options.config.moreYaxis=!1,a.render_chart())})}}(this))},render_chart:function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q;null==a&&(a="line"),null!=this._state.chart&&this._state.chart.destroy(),f=[],m={},p=this.options.data;for(j in p){e=p[j];for(d in e)h=e[d],q=c.data_to_c3(j,d,h.data),j=q[0],l=q[1],g=q[2],m[g]=l,f.push(j.data),f.push(j.label)}return k={xs:m,columns:f,type:"line",axes:{}},this.options.config.moreYaxis!==!1&&(k.axes[this.options.config.moreYaxis]="y2"),i=this.element.find(".chart").attr("id"),n="data_size"===this.options.config.y_format?c.bytesToString:d3.format(this.options.config.y_format),b={bindto:"#"+i,data:k,point:{show:this.options.config.disp_points},padding:{right:50},legend:{position:"bottom"},axis:{x:{type:"timeseries",tick:{format:"%m-%d %H:%M:%S",culling:{max:this.options.config.max_x_labels}}},y:{tick:{format:function(a){return function(a){return n(a)}}(this)}},rotated:!1},grid:{x:{show:!1},y:{show:!1}},subchart:{show:!1}},this.options.config.moreYaxis!==!1&&(b.axis.y2={show:!0}),this.options.config.xgrid===!0&&(b.grid.x.show=!0),this.options.config.ygrid===!0&&(b.grid.y.show=!0),this.options.config.rotateAxis===!0&&(b.axis.rotated=!0),this.options.config.subchart===!0&&(b.subchart.show=!0),o=c3.generate(b),this._state.chart=o,!1},add_metric_data:function(a,b,d){var e,f,g,h,i;return null==this._state.chart?(this.render_chart(),!1):(h={},e=[],i=c.data_to_c3(a,b,d),a=i[0],g=i[1],f=i[2],h[f]=g,e.push(a.data),e.push(a.label),this._state.chart.load({xs:h,columns:e,length:0}),!1)},update_metric_data:function(a,b,d){var e,f,g,h,i;return h={},e=[],i=c.data_to_c3(a,b,d),a=i[0],g=i[1],f=i[2],h[f]=g,e.push(a.data),e.push(a.label),this._state.chart.load({columns:e}),!1},removeMetric:function(a,b){var d;return d=c.to_data_label(b,a),this._state.chart.unload({ids:[d]})},transform_chart:function(a,b,d){return null==a&&(a="spline"),"all"===b?this._state.chart.transform(a):this._state.chart.transform(a,c.to_data_label(b,d))},saveDisplay:function(){return!1},udpateChart:function(){return!1}},c={to_data_label:function(a,b){return a+" ("+b+")"},bytesToString:function(a){var b;return b=d3.format(".0f"),1024>a?b(a)+"B":1048576>a?b(a/1024)+"kB":1073741824>a?b(a/1024/1024)+"MB":1099511627776>a?b(a/1024/1024/1024)+"GB":b(a/1024/1024/1024/1024)+"TB"},data_to_c3:function(a,b,d){var e,f,g,h,i;return i="x-"+a+"-"+b,e=c.to_data_label(b,a),f=[i],h=[e],$.each(d,function(a){return function(a,b){return f.push(moment(1e3*a).toDate()),h.push(parseFloat(b))}}(this)),g={label:f,data:h},[g,i,e]},chart_config:function(a){var b,d,e,f,g,h,i,j,k,l,m;e=a.data,j="";for(k in e){d=e[k];for(b in d)m=d[b],h=c.to_data_label(b,k),l=' <option id="'+h+'">'+k+" "+b+"</option> ",j=j.concat(l)}f="",g={None:"",Currency:"$,",Percentage:".2%","Data size":"data_size",Float:".3g"};for(i in g)m=g[i],f=a.config.y_format===m?f.concat(' <option value="'+m+'" selected> '+i+" </option> "):f.concat(' <option value="'+m+'"> '+i+"</option> ");return f=f.concat(' <option value="custom"> Custom </option> '),'<div class="hide">\n  <form class="form" role="form" id="chart-config">\n    <div class="form-group">\n      <div class="checkbox">\n        <label><input id="add_axis" type="checkbox" value="">\n          Additional Y axis for\n        </label>\n      </div>\n      <select class="form-control" id="metric_select" style="width: 90%; margin-left: 20px;">\n        '+j+'\n      </select>\n    </div>\n\n    <div class="form-group">\n      <div class="checkbox"> <label> Grids :</label>\n        <span> X grid: </span>\n        <span> <input id="add_grid_x" type="checkbox" value=""\n         style="margin-left: 0px;"> </span>\n\n        <span style="margin-left: 20px;"> Y grid: </span>\n        <span> <input id="add_grid_y" type="checkbox" value=""\n         style="margin-left: 5px;"> </span>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="checkbox">\n        <label>\n          <input id="rotate_axis" type="checkbox" value="">\n          Rotate axis\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="checkbox">\n        <label><input id="subchart" type="checkbox" value="">\n          Subchart display\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="checkbox">\n        <label><input id="disp_points" type="checkbox" value="">\n          Circle points\n        </label>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="checkbox">\n        <label> Max X axis labels </label>\n          <input id="max_x_labels" class="form-control" type="number" min=1\n          style="display: inline; margin-left: 10px; width: 30%;">\n\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="checkbox">\n        <label> Y axis label format </label>\n      </div>\n      <div class="checkbox" style="padding-left: 20px;">\n        <select class="form-control" id="format_y_axis"\n        style="display: inline; width: 40%;">\n          '+f+'\n        </select>\n        <input id="custom_y_format" class="form-control" placeholder="Format"\n        style="display: none; max-width: 40%;">\n        <a onclick="window.open(\'http://koaning.s3-website-us-west-2.amazonaws.com/html/d3format.html\', \'_blank\').focus()"\n         style="font-size: small; cursor: pointer;"> Help </a>\n      </div>\n\n\n    </div>\n\n    <div class="form-group" style="padding-left: 20px;">\n      <button type="submit" class="btn btn-primary">Submit »</button>\n    </div>\n  </form>\n</div> '}},h={_create:function(){return this._state={}},_init:function(){return this._init_ui(),this._init_toolbar(),this._toolbar_events(),null==this.options.live&&(this.options.live=!1),null==this.options.granularity&&(this.options.granularity=j.granularity.min),this.options.interval||(this.options.interval=6e4),this.options.live===!0&&this._go_live(),this.options.toolbar.trigger("update_info_time"),this.options.toolbar.trigger("update_info_granularity"),null!=this.options.data?$.each(this.options.data,function(a){return function(b,c){return $.each(c,function(c,d){return a.get_data_from_daemon(b,c),delete a.options.data[b][c]})}}(this)):this.options.data={}},_init_ui:function(){var b;return b=a.graphDisplayC3("c3_display1","chart"),this.element.append(b),this.element.append('<div id="disp_info" style="margin-bottom: 30px; padding-left: 5px;\n  padding-top: 10px;">\n    <i class="fa fa-clock-o" ></i>\n    <span id="selected-time-interval" style="margin-right: 20px;"> time </span>\n    <i class="fa fa-sitemap" ></i>\n    <span id="selected-granularity"> sec </span>\n  </div>')},_init_toolbar:function(){var b,c,d;return d=this.element.find("nav"),d.find("#delDisplay").on("click",function(a){return function(){return a.element.remove()}}(this)),b=d.find("#currentDispMetric"),this.element.on("display_update",function(a){return function(c){return c.stopImmediatePropagation(),b.empty(),$.each(a.options.data,function(a,c){return $.each(c,function(c,d){var e;return e=j.generate_id(),b.append('<li id="'+e+'" data-metric="'+a+'" data-client="'+c+'">\n  <a href="#">'+a+'\n   <span style="font-size: 12px; color:gray;">'+c+"</span>\n  </a>\n</li> ")})}),a._toolbar_events()}}(this)),d.find("#chart_type li").on("click",function(a){return function(b){return b.stopImmediatePropagation(),d.find("#chart_type li#"+b.currentTarget.id).hasClass("active")===!1?(d.find("#chart_type li#"+b.currentTarget.id).find(".fa-angle-down").removeClass("fa-angle-down").addClass("fa-angle-up"),d.find("#chart_type li#"+b.currentTarget.id).addClass("active"),a.show_avail_charts(b.currentTarget.id)):(d.find("#chart_type li#"+b.currentTarget.id).find(".fa-angle-up").removeClass("fa-angle-up").addClass("fa-angle-down"),d.find("#chart_type li#"+b.currentTarget.id).removeClass("active"),a.options.toolbar.find("#chart_type").find("."+b.currentTarget.id).remove())}}(this)),this.inti_daterangepicker(),c=d.find("#range_picker"),c.unbind("apply.daterangepicker"),c.on("apply.daterangepicker",function(a){return function(b){var e,f;return f=c.data("daterangepicker").startDate,e=c.data("daterangepicker").endDate,d.trigger("udpate_info_time"),a.update_all_metrics()}}(this)),d.on("update_info_time",function(a){return function(){var b,d,e,f;return f=c.data("daterangepicker").startDate,d=c.data("daterangepicker").endDate,e=f.format("MMM D YYYY, h:mm:ss a"),b=d.format("MMM D YYYY, h:mm:ss a"),a.element.find("#selected-time-interval").html(e+" - "+b)}}(this)),d.on("update_info_granularity",function(a){return function(){return a.element.find("#selected-granularity").html(a.options.granularity)}}(this)),d.find("#addMetric").on("click",function(a){return function(){return $.event.trigger("selectionStart"),a.toggle_add_button(!0),!1}}(this)),d.find("#selectionDone").on("click",function(b){return function(){var c,d,e,f,g,h,i;for($.event.trigger("selectionDone"),e=a.sideBar(),f=e.sidebar("get_selected_metric"),h=0,i=f.length;i>h;h++)d=f[h],g=d.metric_name,c=d.client_name,null!=b.options.data[g]?null==b.options.data[g][c]&&b.get_data_from_daemon(g,c):b.get_data_from_daemon(g,c);return b.toggle_add_button(!1)}}(this)),$(document).on("selectionCancel",function(a){return function(){return a.toggle_add_button(!1)}}(this)),d.find("#update_metrics i.live").on("click.update",function(a){return function(){return a.options.live===!1?a._go_live():(clearInterval(a.options.live),a.options.live=!1,d.find("#update_metrics").find("a i.live").css("color",""))}}(this)),d.find("#granularity").find("li").on("click",function(a){return function(b){var c;return c=b.currentTarget.id,a.options.granularity=c,a.options.toolbar.trigger("update_info_granularity")}}(this)),d.find("[data-toggle=update-interval-popover]").popover({html:!0,placement:"right",container:this.element,content:function(b){return function(){return $(a.graphToolbar_intervalFrom(b.options.interval/1e3)).html()}}(this)}),d.find("[data-toggle=update-interval-popover]").on("shown.bs.popover",function(a){return function(){var b;return b=a.element.find(".popover").find("#update-interval"),b.on("submit",function(c){var e;return c.preventDefault(),e=b.find("#interval").val(),a.options.interval=1e3*e,d.find("[data-toggle=update-interval-popover]").popover("hide"),a.options.live!==!1?(d.find("#update_metrics i.live").trigger("click.update"),d.find("#update_metrics i.live").trigger("click.update")):void 0})}}(this)),this.options.toolbar=d},_go_live:function(){var a,b;return a=function(a){return function(){return a.element.find("#range_picker").data("daterangepicker").setEndDate(moment()),a.update_all_metrics()}}(this),b=setInterval(a,this.options.interval),this.options.live=b,this.options.toolbar.find("#update_metrics").find("a i.live").css("color","#f44336"),!1},bookmark:function(){var a,b,c,d,e,f,g;c={},g=this.options.data;for(d in g){b=g[d],c[d]={};for(a in b)f=b[a],c[d][a]={data:[]}}return e={config:this.options.config,granularity:this.options.granularity,interval:this.options.interval,live:this.options.live,data:c}},toggle_add_button:function(a){return null==a&&(a=!1),a===!1?(this.options.toolbar.find("#selectionDone").hide(),this.options.toolbar.find("#addMetric").show()):(this.options.toolbar.find("#addMetric").hide(),this.options.toolbar.find("#selectionDone").show())},_toolbar_events:function(){var a,b;return b=this.element.find("nav"),a=this.options.toolbar.find("#removeMetric"),a.find("li").unbind("click.remove"),a.find("li").on("click.remove",function(b){return function(c){var d,e;return e=a.find("#"+c.currentTarget.id).attr("data-metric"),d=a.find("#"+c.currentTarget.id).attr("data-client"),b.removeMetric(e,d),delete b.options.data[e][d],b.element.trigger("display_update")}}(this)),this.element.on("metric_data",function(a){return function(b,c,d,e){return b.stopImmediatePropagation(),null!=a.options.data[c]?null!=a.options.data[c][d]?(a.options.data[c][d]={data:e.metric_data},a.update_metric_data(c,d,e.metric_data)):(a.options.data[c][d]={data:e.metric_data},a.add_metric_data(c,d,e.metric_data)):(a.options.data[c]={},a.options.data[c][d]={data:e.metric_data},a.add_metric_data(c,d,e.metric_data)),a.element.trigger("display_update")}}(this)),!1},update_all_metrics:function(){var a,b,c,d,e,f;e=this.options.data,f=[];for(d in e)b=e[d],f.push(function(){var e;e=[];for(a in b)c=b[a],e.push(this.get_data_from_daemon(d,a));return e}.call(this));return f},show_avail_charts:function(a){var b,c,d,e,f,g,h,i;this.options.toolbar.find("#chart_type").find("."+a).remove(),h=' <li class="'+a+'" data-client="all" data-metric="'+f+'">\n<a href="#" style="font-size: x-small; color: gray;"> All </a></li>',i=this.options.data;for(f in i){c=i[f];for(b in c)d=c[b],g='<li class="'+a+'" data-client="'+b+'" data-metric="'+f+'">\n<a href="#" style="font-size: 11px; color: gray;"> '+f+" ("+b+")</a></li>",h=h.concat(g)}return h=h.concat(' <li role="separator" class="divider '+a+'"></li> '),e=this.options.toolbar.find("#chart_type").find("#"+a),$(h).insertAfter(e),this.options.toolbar.find("#chart_type").find("."+a).on("click",function(c){return function(d){return b=d.currentTarget.dataset.client,f=d.currentTarget.dataset.metric,c.transform_chart(a,b,f)}}(this))},get_data_from_daemon:function(a,b){var c,d,e;return d=this.options.toolbar.find("#range_picker"),e=d.data("daterangepicker").startDate.unix(),c=d.data("daterangepicker").endDate.unix(),$(document).chartDaemon("get_metric_data",this.element,a,b,[e,c],this.options.granularity)},inti_daterangepicker:function(){var a;return a=this.element.find("#range_picker"),a.daterangepicker({parentEl:"#graphDiv",format:"MM/DD/YYYY",startDate:moment().subtract(3,"hours"),endDate:moment(),minDate:"01/01/2015",maxDate:"12/31/2015",showDropdowns:!0,showWeekNumbers:!0,timePicker:!0,timePickerIncrement:1,timePicker12Hour:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"center",drops:"down",buttonClasses:["btn","btn-sm"],applyClass:"btn-primary",cancelClass:"btn-default",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}})}},d={_cache:{},_create:function(){return this._bind_events()},_init:function(){return!1},get_metric_data:function(a,b,c,d,e){var f,g,h,i,j,k;return k=this._lookup_cache(b,c,d,e),i=k[0],f=k[1],i===!1?(h=d[0],g=d[1],j="/metric/data/"+b+"/"+c+"/"+h.toString()+":"+g.toString()+"/"+e,$.ajax({method:"GET",url:j,success:function(d){return function(f){return a.trigger("metric_data",[b,c,f]),d._insert_cache(b,c,e,f.metric_data)}}(this)})):a.trigger("metric_data",[b,c,{metric_data:f}]),!1},_insert_cache:function(a,b,c,d){var e,f,g,h,i;if(null!=(null!=(g=this._cache[a])&&null!=(h=g[b])?h[c]:void 0)){for(e in d)f=d[e],null==this._cache[a][b][c][e]&&(this._cache[a][b][c][e]=f);this._sort_data(a,b,c)}else null!=(null!=(i=this._cache[a])?i[b]:void 0)?(this._cache[a][b][c]={},this._insert_cache(a,b,c,d)):null!=this._cache[a]?(this._cache[a][b]={},this._insert_cache(a,b,c,d)):(this._cache[a]={},this._cache[a][b]={},this._cache[a][b][c]=d);return!1},_sort_data:function(a,b,c){var d,e,f,g,h;for(f=Object.keys(this._cache[a][b][c]).sort(),d={},g=0,h=f.length;h>g;g++)e=f[g],d[e]=this._cache[a][b][c][e];return this._cache[a][b][c]=d,!1},_lookup_cache:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;if(null!=(null!=(n=this._cache[a])&&null!=(o=n[b])?o[d]:void 0)){if(k=c[0],j=c[1],e={},h=Object.keys(this._cache[a][b][d]),i=h.length,l=parseInt(h[0]),f=parseInt(h[h.length-1]),k>=l&&f>=j){p=this._cache[a][b][d];for(g in p)m=p[g],g>=k&&j>=g&&(e[g]=m);return[!0,e]}return[!1,[]]}return[!1,[]]},_bind_events:function(){return $(document).on("metricData",function(a,b){return this._cache[b.metric]=b.points})}},g=function(){var a,b;return a={labels:["January","February","March","April","May","June","July"],datasets:[{label:"Metric 1",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:[65,59,80,81,56,55,40]},{label:"Metric 2",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:[28,48,40,19,86,27,90]}]},b={metric1:{client1:{data:[{"2013-01-01":300},{"2013-01-02":200},{"2013-01-03":100},{"2013-01-04":400},{"2013-01-05":150},{"2013-01-06":250}]}},metric2:{client2:{data:[{"2013-01-01":130},{"2013-01-02":340},{"2013-01-03":200},{"2013-01-04":500},{"2013-01-05":250},{"2013-01-07":350}]}}},!1},f={_create:function(){return this._state={}},_init:function(){return this._super()},_init_ui:function(){return this.element.append(a.graphDisplayCharjs("c3_display1","chart"))},render_chart:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;null==a&&(a="line"),null!=this._state.chart&&this._state.chart.destroy(),d=[],n=this.options.data;for(e in n){for(j=n[e],f=this.options.data[e].label,c=this.options.data[e].data,g=f.length,i=[],l=m=0,o=g-1;o>=0?o>=m:m>=o;l=o>=0?++m:--m)i.push({x:new Date(f[l]),y:c[l]});d.push({label:e,data:i})}return b=this.element.find("canvas"),k=b.get(0).getContext("2d"),h=new Chart(k).Scatter(d,{bezierCurve:!0,datasetStrokeWidth:1,pointDotRadius:3,showTooltips:!0,scaleShowLabels:!0,scaleType:"date",scaleShowHorizontalLines:!1,scaleShowVerticalLines:!1}),this._state.chart=h,this.options.toolbar.find("#currentDispMetric").trigger("display_update"),!1},addChart:function(a){return!1},udpateChart:function(){return!1},_bind_events:function(){var a;return a=this.element.find("nav"),this.options.toolbar.find("#removeMetric li").unbind("click.remove"),this.options.toolbar.find("#removeMetric li").on("click.remove",function(a){return function(b){var c;return c=b.currentTarget.id,a.options.data.datasets.splice(c,1),a.render_chart()}}(this)),!1}},e={config:{lineChart:{scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:1,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},global:{animation:!0,animationSteps:30,animationEasing:"easeOutQuart",showScale:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"#000000",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleIntegersOnly:!0,scaleBeginAtZero:!1,scaleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",responsive:!0,maintainAspectRatio:!0,showTooltips:!0,customTooltips:!1,tooltipEvents:["mousemove","touchstart","touchmove"],tooltipFillColor:"rgba(0,0,0,0.8)",tooltipFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontSize:14,tooltipFontStyle:"normal",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTitleFontSize:14,tooltipTitleFontStyle:"bold",tooltipTitleFontColor:"#fff",tooltipYPadding:6,tooltipXPadding:6,tooltipCaretSize:8,tooltipCornerRadius:6,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%= value %>",onAnimationProgress:function(){},onAnimationComplete:function(){}}}},$(document).ready(function(){return $.widget("grapherl.dashboard",h),$.widget("grapherl.c3_chartify",$.grapherl.dashboard,b),$.widget("grapherl.chartify",$.grapherl.dashboard,b),$.widget("grapherl.chartDaemon",d),$.widget("grapherl.sidebar",m),$(document).chartDaemon(),k(),console.log("Grapherl client loaded !"),!1}),k=function(){return i(),l()},i=function(){var b;return b=a.sideBar(),b.sidebar()},j={generate_id:function(){return $("<div></div>").uniqueId().attr("id")},add_display:function(b){var c,d;return c=$(a.graphDiv()),d=$(a.graphNew()),d.find("#display").chartify(b),c.append(d)},add_split_display:function(b){var c,d,e;return null==b&&(b=void 0),d=$(a.graphDiv()),e=$(a.graphNewSplit()),void 0===b?e.find("#display").chartify({split:!0}):(c=e.find("#display"),b[0].split=!0,b[1].split=!0,$(c[0]).chartify(b[0]),$(c[1]).chartify(b[1])),d.append(e),d},save_display:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(j=$(a.graphDiv()).find(".row"),g=[],k=0,m=j.length;m>k;k++){for(i=j[k],d=$(i).find(".chartified"),b=[],l=0,n=d.length;n>l;l++)c=d[l],b.push($(c).chartify("bookmark"));void 0!==b[0]&&g.push(b)}return h=JSON.stringify(g),f=window.btoa(h),$("#bookmark_download").remove(),e=$("<a id='bookmark_download' download='grapherl_display_bookmark.dat' href='data:application/octet-stream;charset=utf-8;base64,"+f+"' style='display:none;'></a>"),$(a.graphDiv()).append(e),document.getElementById("bookmark_download").click()},load_display:function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],1===b.length?e.push(j.add_display(b[0])):2===b.length?e.push(j.add_split_display(b)):e.push(void 0);return e},get_interval:function(a){return a===j.granularity.sec?15e3:a===j.granularity.min?6e4:(a===j.granularity.hour,36e5)},granularity:{sec:"sec",min:"min",hour:"hour",day:"day",week:"week",month:"month"}},a={globalToolbar:function(){return $("#global-nav")},sideBar:function(){return $("#sidebar")},sideBar_metricList:function(){return $("#active-metrics")},sideBar_li:function(a,b,c){var d;return d=j.generate_id(),'<li title="'+b+'" data-metric="'+a+'" data-client="'+b+'"\n  class="client" id="'+d+'">\n  <a href="#" style="padding: 5px;">  '+c+"</a>\n</li> "},graphDiv:function(){return $("#graphDiv")},graphNew:function(){var a;return a=j.generate_id(),'<div class="row">\n  <div class="col-md-12 chartified" data-chart-name="'+a+'" id="display" >\n  </div>\n</div> '},graphNewSplit:function(){var a,b;return a=j.generate_id(),b=j.generate_id(),'<div class="row" >\n  <div class="col-md-6 chartified" data-chart-name="'+a+'" id="display" > </div>\n  <div class="col-md-6 chartified" data-chart-name="'+b+'" id="display" > </div>\n</div> '},graphDisplayC3:function(b,c){var d,e;return d=$(a.graphFrame(b)),e=j.generate_id(),d.append('<div class="chart" id="'+e+'"></div>'),d.append(a.graphToolbar()),d},graphDisplayCharjs:function(b,c){var d;return d=$(a.graphFrame(b)),d.append(a.graphCanvas(c)),d.append(a.graphToolbar()),d},graphFrame:function(a){return null==a&&(a="display1"),'<div class="well graphDisplay" id="'+a+'" style="margin-bottom: 0px;"> </div>'},graphCanvas:function(a){return null==a&&(a="chart"),'<div> <canvas id="'+a+'"></canvas> </div> '},graphToolbar_intervalFrom:function(a){return'<div id="popover-content" class="hide">\n  <form class="form-inline" role="form" id="update-interval">\n    <div class="form-group">\n      <input id="interval" value="'+a+'" type="number"\n       placeholder="Seconds" class="form-control" maxlength="5"\n        type="text" style="max-width:120px;">\n      <button type="submit" class="btn btn-primary">Update »</button>\n    </div>\n  </form>\n</div> '},graphToolbar:function(){return'<hr style="border-color:rgba(179, 179, 179, 0.6); margin:0px;">\n\n<nav class="navbar navbar-fixed-bottom" style="position:relative;">\n  <div class="container-fluid">\n\n\n  <!-- Collect the nav links, forms, and other content for toggling -->\n    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n\n      <ul class="nav navbar-nav">\n        <li class="dropdown" id="chart_type" >\n          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"\n            aria-expanded="false"><i class="fa fa-gear"></i></a>\n          <ul class="dropdown-menu">\n            <li id="bar"> <a href="#"><i class="fa fa-bar-chart"></i> Bar chart <i class="fa fa-angle-down pull-right"></i></a></li>\n            <li id="line"> <a href="#"><i class="fa fa-line-chart"></i> Line chart <i class="fa fa-angle-down pull-right"></i></a></li>\n            <li id="spline"> <a href="#"><i class="fa fa-line-chart"></i> Spline chart <i class="fa fa-angle-down pull-right"></i></a></li>\n          </ul>\n        </li>\n\n\n        <li title="Specify interval" id="range_picker" ><a href="#"><i class="fa fa-clock-o"></i></a></li>\n\n        <!-- <li title="Duplicate display" id="duplicate"><a href="#"><i class="fa fa-copy"></i></a></li> -->\n        <li title="Add more metric" id="addMetric"><a href="#"><i class="fa fa-plus-square-o"></i></a></li>\n        <li title="Add more metric" id="selectionDone" style="display:none;"><a href="#"><i class="fa fa-square-o"></i></a></li>\n\n        <li class="dropdown" title="Remove metric" id="removeMetric">\n          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"\n            aria-expanded="false"><i class="fa fa-minus-square-o"></i></a>\n          <ul class="dropdown-menu" id="currentDispMetric">\n            <li><a href="#"><i class="fa fa-pie-chart"></i> Pie chart</a></li>\n          </ul>\n        </li>\n\n        <li title="Go live" id="update_metrics" >\n           <a href="#">\n              <i class="fa fa-refresh live"></i>\n\n              <span  data-placement="bottom" data-toggle="update-interval-popover" data-title="Change udpate interval"\n                data-container="body" type="button" data-html="true" href="#">\n                <i class="fa fa-angle-down"></i>\n              </span>\n          </a>\n        </li>\n\n\n\n        <li class="dropdown" title="Granularity">\n          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"\n            aria-expanded="false"><i class="fa fa-sitemap"></i></a>\n          <ul class="dropdown-menu" id="granularity">\n            <li id="'+j.granularity.sec+'" ><a href="#">Seconds</a></li>\n            <li id="'+j.granularity.min+'" ><a href="#">Minutes</a></li>\n            <li id="'+j.granularity.hour+'" ><a href="#">Hours</a></li>\n            <li id="'+j.granularity.day+'" ><a href="#">Days</a></li>\n            <li id="'+j.granularity.week+'" ><a href="#">Weeks</a></li>\n            <li id="'+j.granularity.month+'" ><a href="#">Months</a></li>\n          </ul>\n        </li>\n\n      <li class="chartify_hook"></li>\n\n\n      </ul>\n\n      <ul class="nav navbar-nav navbar-right">\n        <li title="Remove display" id="delDisplay"><a href="#"><i class="fa fa-trash-o"></i></a></li>\n        <!-- <li title="Save" id="saveDisplay"><a href="#"><i class="fa fa-save"></i></a></li> -->\n      </ul>\n\n    </div><!-- /.navbar-collapse -->\n  </div><!-- /.container-fluid -->\n</nav>'}},m={_create:function(){return!1},_init:function(){return this.options.display="client",this._bind_sidebar_events(),null!=this.options.data?$(document).trigger("ui.update_sideBar",[this.options.data]):this.element.find("#sidebar-refresh").click(),!1},_bind_sidebar_events:function(){var a;return $(document).on("ui.update_sideBar",function(a){return function(b,c){return a.element.find("#active-metrics").empty(),a.options.data=c,a._add_sidebar_elements(c),a._bind_select_metric()}}(this)),$(document).on("selectionDone",function(a){return function(){var b,c,d,e,f,g;for(a.element.find(".selected").find("a").css("color",""),a.element.find(".selected").effect("highlight",{color:"#ffcdd2"},1e3),c=[],g=a.element.find(".selected").closest("li"),e=0,f=g.length;f>e;e++)d=g[e],b={metric_name:$(d).attr("data-metric"),client_name:$(d).attr("data-client")},c.push(b);return a.element.find(".selected").removeClass("selected"),a.options.selected=c,a._unbind_multi_selection(),a._bind_select_metric()}}(this)),$(document).on("selectionStart",function(a){return function(){return $.event.trigger("selectionCancel"),a._unbind_select_metric(),a._unbind_multi_selection(),a._multi_selection()}}(this)),this.element.find("#sidebar-refresh").on("click",function(a){return function(){return $.ajax({method:"GET",url:"/metric/list",success:function(a){return $.event.trigger("ui.update_sideBar",[a.metric_list]);
}})}}(this)),this.element.find("#sb-disp-client").on("click",function(a){return function(b){return a.options.display="client",$(document).trigger("ui.update_sideBar",[a.options.data])}}(this)),this.element.find("#sb-disp-metric").on("click",function(a){return function(b){return a.options.display="metric",$(document).trigger("ui.update_sideBar",[a.options.data])}}(this)),a=function(a){return function(){return a.element.find("#sidebar-refresh").click()}}(this),setInterval(a,6e4)},get_selected_metric:function(){return this.options.selected},_bind_select_metric:function(){return this.element.find("li.client").on("click.select",function(a){return function(a){var b,c,d;return d=$(a.currentTarget).attr("data-metric"),b=$(a.currentTarget).attr("data-client"),c={},c[d]={},c[d][b]={data:[]},j.add_display({data:c})}}(this))},_unbind_select_metric:function(){return this.element.find("li.client").unbind("click.select")},_unbind_multi_selection:function(){return this.element.find("li").unbind("click.multi_select"),this.element.find(".multi-select").remove(),this.element.find(".multi-selected").remove()},_add_sidebar_elements:function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(f=this.element.find("#active-metrics"),e={},"client"===this.options.display){for(g in b)for(d=b[g],j=0,m=d.length;m>j;j++)c=d[j],null!=e[c]?e[c].push(g):e[c]=[g];for(d=Object.keys(e).sort(),p=[],k=0,n=d.length;n>k;k++)c=d[k],f.append('<li title="'+c+'" class="metric disabled">\n  <a href="#" style="text-align: center;">'+c+"</a>\n</li> "),h=e[c].sort(),p.push(function(){var b,d,e;for(e=[],b=0,d=h.length;d>b;b++)g=h[b],e.push(f.append(a.sideBar_li(g,c,g)));return e}());return p}for(h=Object.keys(b).sort(),q=[],l=0,o=h.length;o>l;l++)g=h[l],f.append('<li title="'+g+'" class="metric disabled">\n  <a href="#" style="text-align: center;">'+g+"</a>\n</li> "),i=b[g].sort(),q.push(function(){var b,d,e;for(e=[],d=0,b=i.length;b>d;d++)c=i[d],e.push(f.append(a.sideBar_li(g,c,c)));return e}());return q},_multi_selection:function(){return this.options.selected=[],this.element.find("li").on("click.multi_select",function(a){return function(b){var c;return c=a.element.find("li#"+b.currentTarget.id),c.hasClass("selected")===!1?(c.find("a").css("color","#f44336"),c.addClass("selected")):(c.removeClass("selected"),c.find("a").css("color",""))}}(this))}},l=function(){var b;return b=a.globalToolbar(),b.find("#addDisplay").on("click",function(a){return function(){return j.add_display()}}(this)),b.find("#addSplitDisplay").on("click",function(a){return function(){return j.add_split_display()}}(this)),b.find("#bookmarkWindow").on("click",function(a){return function(){return j.save_display()}}(this)),$(a.graphDiv()).find("#load-bookmark").on("change",function(a){return function(a){var b,c;return b=a.target.files[0],b?(c=new FileReader,c.onload=function(a){return j.load_display(JSON.parse(a.target.result))},c.readAsText(b)):void 0}}(this))}}).call(this);